plugins {
    id "org.openrepose.gradle.plugins.jaxb" version "2.5.0"
}
description = 'Apache Isis Core - Schemas'
apply plugin: 'war'
apply plugin: 'io.freefair.lombok'

sourceSets {
    main {
        java {
            srcDir "${buildDir}/generated-sources/xjc"
        }
    }
}

dependencies {
    compile project(':isis-parent:isis:isis-core-commons')

    compile(Libs.springContext)
    compile(Libs.jodaTime)

    // These dependencies are required in order to build on jdk11
    jaxb(Libs.jaxbApi)  // not set in POM`s ??
    jaxb(Libs.jaxbCore)
    jaxb(Libs.jaxbImpl)
    jaxb(Libs.jaxbXjc)
    jaxb("org.jvnet.jaxb2_commons:jaxb2-namespace-prefix:1.3")
}

task packageTests(type: Jar) {
    from sourceSets.test.output
    classifier = 'tests'
}
artifacts.archives packageTests

jaxb {
	xsdDir = "${project.projectDir}/src/main/resources/org/apache/isis/schema"
 	xsdIncludes = ['**/*.xsd']
 	bindingsDir = "${project.projectDir}/src/main/resources/org/apache/isis/schema"
 	bindings = ['*.xml']
 	xjc {
 		accessExternalSchema = 'file'
 		args = ["-Xnamespace-prefix"]
 	}
}

compileJava {
	dependsOn xjc
}

// required due to bug 
// https://github.com/rackerlabs/gradle-jaxb-plugin/issues/36
tasks.named("xsd-dependency-tree").configure {
    outputs.upToDateWhen { false }
}
